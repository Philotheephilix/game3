# Game Queries for Dojo Heist Game

# Query: Get Active Game Session
query GetActiveSession($player: String!) {
  gameSessions(
    where: {
      player: $player,
      is_active: true
    },
    limit: 1
  ) {
    edges {
      node {
        session_id
        world_id
        start_block
        end_block
        current_loot_value
        collected_asset_count
        player_x
        player_y
        health
        is_active
        has_returned_safely
        alarm_triggered
      }
    }
  }
}

# Query: Get Player Profile
query GetPlayerProfile($player: String!) {
  playerProfiles(
    where: {
      player: $player
    },
    limit: 1
  ) {
    edges {
      node {
        player
        total_banked_loot
        lifetime_collected
        total_runs
        successful_runs
        failed_runs
        current_streak
        best_streak
        joined_at
      }
    }
  }
}

# Query: Get Player Upgrades
query GetPlayerUpgrades($player: String!) {
  playerUpgrades(
    where: {
      player: $player
    },
    limit: 1
  ) {
    edges {
      node {
        player
        speed_level
        stealth_level
        detector_level
        health_level
        time_extension_level
      }
    }
  }
}

# Query: Get World Details
query GetWorld($worldId: Int!) {
  worlds(
    where: {
      world_id: $worldId
    },
    limit: 1
  ) {
    edges {
      node {
        world_id
        name
        asset_count
        grid_width
        grid_height
        difficulty
        time_limit_blocks
        safe_zone_x
        safe_zone_y
        is_active
        created_at
        created_by
      }
    }
  }
}

# Query: Get All Active Worlds
query GetActiveWorlds {
  worlds(
    where: {
      is_active: true
    }
  ) {
    edges {
      node {
        world_id
        name
        asset_count
        grid_width
        grid_height
        difficulty
        time_limit_blocks
        safe_zone_x
        safe_zone_y
      }
    }
  }
}

# Query: Get World Assets
query GetWorldAssets($worldId: Int!) {
  worldAssets(
    where: {
      world_id: $worldId
    }
  ) {
    edges {
      node {
        world_id
        asset_id
        position_x
        position_y
        value
        asset_type
        danger_level
      }
    }
  }
}

# Query: Get Asset at Position
query GetAssetAtPosition($worldId: Int!, $positionX: Int!, $positionY: Int!) {
  worldAssets(
    where: {
      world_id: $worldId,
      position_x: $positionX,
      position_y: $positionY
    },
    limit: 1
  ) {
    edges {
      node {
        asset_id
        value
        asset_type
        danger_level
      }
    }
  }
}

# Query: Get Collected Assets for Session
query GetCollectedAssets($player: String!, $sessionId: String!) {
  sessionAssetCollections(
    where: {
      player: $player,
      session_id: $sessionId
    }
  ) {
    edges {
      node {
        player
        session_id
        asset_id
        collected_at_block
      }
    }
  }
}

# Query: Get All Game Sessions for Player
query GetPlayerSessions($player: String!) {
  gameSessions(
    where: {
      player: $player
    },
    order_by: {
      start_block: DESC
    }
  ) {
    edges {
      node {
        session_id
        world_id
        start_block
        end_block
        current_loot_value
        collected_asset_count
        is_active
        has_returned_safely
        alarm_triggered
      }
    }
  }
}

# Query: Get World Registry (Admin Info)
query GetWorldRegistry {
  worldRegistries(
    where: {
      registry_id: 0
    },
    limit: 1
  ) {
    edges {
      node {
        registry_id
        total_worlds
        admin
      }
    }
  }
}

# Subscription: Subscribe to Active Session Updates
subscription SubscribeActiveSession($player: String!) {
  gameSessions(
    where: {
      player: $player,
      is_active: true
    }
  ) {
    id
    session_id
    world_id
    current_loot_value
    collected_asset_count
    player_x
    player_y
    health
    end_block
  }
}

# Subscription: Subscribe to Player Profile Updates
subscription SubscribePlayerProfile($player: String!) {
  playerProfiles(
    where: {
      player: $player
    }
  ) {
    id
    total_banked_loot
    lifetime_collected
    total_runs
    successful_runs
    failed_runs
    current_streak
    best_streak
  }
}

